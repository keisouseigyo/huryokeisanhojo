<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta content="ja" http-equiv="Content-Language" />
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

    <title>給気風量 選定補助 ver2.00</title>
    <style type="text/css">
        .input-style {
            background-color: #ffff99;
        }
        .output-style {
            background-color: #caf5ff;
        }
    </style>
</head>

<body>

    <p>
        <strong>エアロアイ or カラムアイ:</strong>
        <select id="ComboBox-SelectMode" name="Mode" style="WIDTH: 145px" class="input-style">
            <option value="aero" selected>エアロアイ</option>
            <option value="column">カラムアイ</option>
        </select>
    </p>

    <p>
        <strong>型式:</strong>
        <select id="ComboBox-Select1" name="ｴｱﾛｱｲ" style="WIDTH: 145px" class="input-style">
            <option value="" selected></option>
            <option value="0">AE100D</option>
            <option value="1">AE150D</option>
            <option value="2">AE200D</option>
            <option value="3">AE250D</option>
            <option value="4">AE300D</option>
            <option value="5">AE350D</option>
            <option value="6">AE400E</option>
        </select>

        <!--計算ボタン-->
        <button id="KEISAN" name="Abutton1" style="margin-left: 100px;">計算</button>
    </p>

    <hr color="#000e01">

    <!--給気最大風量テキストボックス-->
    <p>
        <strong>給気最大風量<br>Qmax= </strong>
        <label>
            <input id="MAXFURYO" name="Text1" class="input-style">
            <strong> m<sup>3</sup>/min </strong>
        </label>
    </p>

    <!--エアロアイ内径寸法テキストボックス-->
    <p>
        <strong id="modeLabel1">エアロアイ</strong>
        <strong>内径寸法<br>D =</strong>
        <strong>
            <input id="NAIKEI" name="Text1" readOnly> mm
        </strong>
    </p>

    <!--エアロアイ面積テキストボックス-->
    <p>
        <strong id="modeLabel2">エアロアイ</strong>
        <strong>内部断面積<br>A =</strong>
        <input id="MENSEKI" name="Text2" readOnly>
        <strong>m<sup>2</sup></strong>
    </p>

    <!--エアロアイ風速テキストボックス-->
    <p>
        <strong id="modeLabel3">エアロアイ</strong>
        <strong>風速<br>Vmax=</strong>
        <input id="FUSHOKU" name="Text1" readOnly>
        <strong> m/s 
            <span id="warningText" style="color: red; font-weight: bold; display: none;">※風速が25m/sを超えています！</span>
        </strong>
    </p>

    <hr color="#000e02">

    <!--空気温度テキストボックス-->
    <p>
        <strong>空気温度<br>T=</strong>
        <input id="ONDO" name="Text1" value="80.0">
        <strong> ℃</strong>
    </p>

    <!--ダクト内静圧テキストボックス-->
    <p>
        <strong>ダクト内静圧<br>P=</strong>
        <input id="SEIATU" name="Text1" value="0">
        <strong>Pa</strong>
    </p>

    <p>
        <strong>使用空気密度<br>γ =</strong>
        <input id="MITUDO" name="Text1">
        <strong>kg/m<sup>3</sup></strong>
    </p>

    <hr color="#000e02">

    <p>
        <strong>センサ係数α =</strong>
        <input id="KEISHU" name="Text1">
    </p>

    <!--センサ係数表-->
    <p>
        <table border="1" style="border-collapse: collapse; font-family: 'ＭＳ Ｐゴシック'; width: 450pt; text-align: center; font-weight: bold;">
            <caption style="font-weight: bold; margin-bottom: 10px;text-align: left;">センサ係数表（SS、SUS製も同じ係数）</caption>
            <thead>
                <tr style="height: 30pt;">
                    <th>AE100D</th>
                    <th>AE150D</th>
                    <th>AE200D</th>
                    <th>AE250D</th>
                    <th>AE300D</th>
                    <th>AE350D</th>
                    <th>AE400E</th>
                    <th>CE50A22</th>
                    <th>CE80A34</th>
                </tr>
            </thead>
            <tbody>
                <tr style="height: 30pt;" >
                    <td>0.7</td>
                    <td>0.77</td>
                    <td>0.81</td>
                    <td>0.83</td>
                    <td>0.85</td>
                    <td>0.86</td>
                    <td>0.87</td>
                    <td>0.00157</td>
                    <td>0.00343</td>
                </tr>
            </tbody>
        </table>
    </p>

    <hr color="#000e02">
    
    <p>
        <strong>動圧<br>ＶＰ =</strong>
        <input id="DOUATU" name="Text1">
        <strong>Pa</strong>
    </p>

    <p>
        <strong>微差圧伝送器のレンジ</strong><br>
        <input id="SAATUKEI" name="Text1" class="output-style">
        <strong>Pa </strong>
    </p>

    <hr color="#000e02">

    <!--風量計算表-->
    <p>
        <table border="1" style="border-collapse: collapse;font-weight: bold; font-family: 'ＭＳ Ｐゴシック';width:450pt;text-align: center;" class="output-style">
            <caption style="font-weight: bold; margin-bottom: 10px; text-align: left;">選定された微差圧伝送器での風量計算表</caption>
            <thead>
                <tr style="height: 20pt;background-color:#ffffff;">
                    <th scope="col">風量（%）</th>
                    <th scope="col">風量（m³/min）</th>
                    <th scope="col">風速 (m/s)</th>
                    <th scope="col">電流 (4-20mA)</th>
                    <th scope="col">動圧 (Pa)</th>
                </tr>
            </thead>
            <tbody id="resultTableBody">
                <tr style="height: 20pt">
                    <td id="cell11"></td>
                    <td id="cell12"></td>
                    <td id="cell13"></td>
                    <td id="cell14"></td>
                    <td id="cell15"></td>
                </tr>
                <tr style="height: 20pt">
                    <td id="cell21"></td>
                    <td id="cell22"></td>
                    <td id="cell23"></td>
                    <td id="cell24"></td>
                    <td id="cell25"></td>
                </tr>
                <tr style="height: 20pt">
                    <td id="cell31"></td>
                    <td id="cell32"></td>
                    <td id="cell33"></td>
                    <td id="cell34"></td>
                    <td id="cell35"></td>
                </tr>
                <tr style="height: 20pt">
                    <td id="cell41"></td>
                    <td id="cell42"></td>
                    <td id="cell43"></td>
                    <td id="cell44"></td>
                    <td id="cell45"></td>
                </tr>
                <tr style="height: 20pt">
                    <td id="cell51"></td>
                    <td id="cell52"></td>
                    <td id="cell53"></td>
                    <td id="cell54"></td>
                    <td id="cell55"></td>
                </tr>
            </tbody>
        </table>
    </p>
<!-- 風量計算表ここまで -->

<script type="text/javascript">
    const aeroOptions = [
        { value: "", text: "" },
        { value: "0", text: "AE100D" },
        { value: "1", text: "AE150D" },
        { value: "2", text: "AE200D" },
        { value: "3", text: "AE250D" },
        { value: "4", text: "AE300D" },
        { value: "5", text: "AE350D" },
        { value: "6", text: "AE400E" }
    ];

    const columnOptions = [
        { value: "", text: "" },
        { value: "0", text: "CE50A22" },
        { value: "1", text: "CE80A34" }
    ];

    // モード選択時に型式を更新
    document.getElementById("ComboBox-SelectMode").addEventListener("change", function () {
        const comboBox = document.getElementById("ComboBox-Select1");
        const selectedMode = this.value; // 選択されたモードを取得
        const options = selectedMode === "aero" ? aeroOptions : columnOptions;

        comboBox.innerHTML = ""; // コンボボックスの内容をクリア

        options.forEach(option => {
            const opt = document.createElement("option");
            opt.value = option.value;
            opt.textContent = option.text;
            comboBox.appendChild(opt);
        });

        // modeLabel1～modeLabel3を一括更新
        const modeLabels = [
            document.getElementById("modeLabel1"),
            document.getElementById("modeLabel2"),
            document.getElementById("modeLabel3")
        ];

        const labelText = selectedMode === "aero" ? "エアロアイ" : "カラムアイ";
        modeLabels.forEach(label => {
            label.innerHTML = labelText;
        });
    });

    // 計算ボタンの動作
    $('#KEISAN').click(function () {
        let AIRAIData = [
            [0.7, 100, 0.0078539816],
            [0.77, 150, 0.0176714587],
            [0.81, 200, 0.0314159265],
            [0.83, 250, 0.0490873852],
            [0.85, 300, 0.0706858347],
            [0.86, 350, 0.096211275],
            [0.87, 400, 0.1256637061],
            [0.00157, 50, 0.0019634954],
            [0.00343, 80, 0.0050265482]
        ];

        // モードを取得
        const mode = document.getElementById("ComboBox-SelectMode").value;

        // 型式の値を取得
        let lineNum = parseInt(document.getElementById("ComboBox-Select1").value, 10);

        // モードに応じてlineNumを調整
        if (mode === "column") {
            lineNum += 7; // columnOptionsの場合、lineNumに7を加算
        }

        const work0 = document.getElementById("MAXFURYO").value;

        if (work0 === "") {
            alert("最大風量が未入力");
            return;
        }

        let Data = AIRAIData[lineNum];

        $('#KEISHU').val(Data[0]);
        $('#NAIKEI').val(Data[1]);
        $('#MENSEKI').val(Data[2]);

        const work1 = (Data[1] / 2 / 1000) ** 2 * 3.1415;
        $('#MENSEKI').val(work1);

        const work2 = work0 / 60 / work1;
        $('#FUSHOKU').val(work2);

        if (work2 > 25) {
            document.getElementById("warningText").style.display = "block";
        } else {
            document.getElementById("warningText").style.display = "none";
        }

        const work3 = 1.293 * 273.15 / (273.15 + 1 * document.getElementById("ONDO").value) *
            (101325 + 1 * document.getElementById("SEIATU").value) / 101325;
        $('#MITUDO').val(work3);

        let work4 = 0; // 動圧 (Pa)
        if (mode === "aero") {
            work4 = (work2 / Data[0]) ** 2 * work3 / 2;
        } else if (mode === "column") {
            work4 = (work0 / Data[0] / 60) ** 2 * work3 / 2;
        }
        $('#DOUATU').val(work4);

        let work5 = 0.0;
        if (work4 > 1000) {
            work5 = 2000;
        } else if (work4 > 750) {
            work5 = 1000.0;
        } else if (work4 > 500) {
            work5 = 750.0;
        } else if (work4 > 300) {
            work5 = 500.0;
        } else if (work4 > 200) {
            work5 = 300.0;
        } else if (work4 > 100) {
            work5 = 200.0;
        } else if (work4 > 75) {
            work5 = 100.0;
        } else if (work4 > 50) {
            work5 = 75.0;
        } else if (work4 > 30) {
            work5 = 50.0;
        }
        $('#SAATUKEI').val(work5);

        let work6 = 0;
        if (mode === "aero") {
            work6 = 60 * work1 * Data[0] * Math.sqrt(2 / work3 * work5); // 選定した伝送器での最大風量（エアロアイ）
        } else if (mode === "column") {
            work6 = 60 * Data[0] * Math.sqrt(2 / Math.sqrt(work3) * work5); // 選定した伝送器での最大風量（カラムアイ）
        }

        let work7 = 0;  // 風量（%）
        let work8 = 0; // 風量（m³/min）
        let work9 = 0; // 風速 (m/s)
        let work10 = 0; // 電流 (4-20mA)
        let work11 = 0; // 動圧 (Pa)

        for (let rowIndex = 0; rowIndex < 5; rowIndex++) {
            for (let colIndex = 0; colIndex < 5; colIndex++) {
                const cellId = `cell${rowIndex + 1}${colIndex + 1}`; // 例: cell11, cell12, ...
                const cell = document.getElementById(cellId);
                if (colIndex === 0) {
                    work7 = Math.sqrt(rowIndex / 4) * 100; // 風量（%）
                    cell.innerText = work7.toFixed(1);
                } else if (colIndex === 1) {
                    work8 = Math.sqrt(work6 ** 2 * rowIndex / 4); // 風量（m³/min）
                    cell.innerText = work8.toFixed(1);
                } else if (colIndex === 2) {
                    work9 = work8 / 60 / work1; // 風速 (m/s)
                    cell.innerText = work9.toFixed(1);
                } else if (colIndex === 3) {
                    work10 = (4 + 4 * rowIndex); // 電流 (4-20mA)
                    cell.innerText = work10.toFixed(3);
                } else if (colIndex === 4) {
                    work11 = (work5 / 4 * rowIndex); // 動圧 (Pa)
                    cell.innerText = work11.toFixed(1);
                }
            }
        }
    });
</script>

</body>
</html>
